# Index
## Rancher
80,443   - Rancher - Server<br>
8001     - Rancher - php:7.1.26-apache<br>

## Containers
20,21,47400-47470 - bogem/ftp
3306 - mysql:5.7
8080 - phpmyadmin/phpmyadmin
8200 - 

# Servidor Padrão
## Rede
Verifica se ter a rede bridge.66.6<br>
```
docker network ls
```
Se não tiver, crie<br>
```
docker network create \
  -d \
  bridge \
  --subnet 66.6.0.0/16 \
  --gateway 66.6.0.1 \
  bridge.66.6
```
Verifique quais IPs estão vagos<br>
```
docker network inspect bridge.66.6
```
Estou vendo uma forma de melhorar a apresentação dos dados:<br>
```
docker network inspect bridge.66.6 -f {{.Containers}}
```

## Volume
Verifique quais volumes existem:<br>
```
docker volume ls
```
Crie o volume para a aplicação (caso saiba qual pasta deseja persistir os dados)<br>
```
docker volume create mysql
docker volume create nextcloud
```
Verifique se foi criado<br>
```
docker volume ls
```
## Banco de dados
### MySQL
```
docker run \
    -d \
    -p 3306:3306 \
    -e MYSQL_ROOT_PASSWORD=my-password \
    -e MYSQL_USER=root \
    -e MYSQL_PASSWORD=my-password \
    -v mysql:/var/lib/mysql \
    --network bridge.66.6 \
    --name mysql.5.7 \
    --ip 66.6.0.5 \
    --restart=always \
    mysql:5.7
```
### phpmyadmin
```
docker run \
    -d \
    -p 8080:80 \
    -e PMA_HOST=mysql.5.7 \
    --network bridge.66.6 \
    --name phpmyadmin \
    --ip 66.6.0.15 \
    --restart=always \
phpmyadmin/phpmyadmin
```

### nextcloud
```
docker run \
  -d \
  -p 8000:80 \
  -v nextcloud:/var/www/html \
  --network bridge.66.6 \
  --name nextcloud \
  --ip 66.6.0.20 \
  --restart=always \
nextcloud
```

# Iniciar o Container com o Docker
Rode a imagem que deseja que seja iniciada com o sistema<br>

Liste a imagem para ver o id<br>
```
docker ps
```
Vamos suport que o id inicie com 98...<br>
Pare a imagem.<br>
```
docker stop 98
```
Vamos listar todas as imagens.<br>
```
docker ps -a
```
Vamos dar o comando para que a imagem inicie junto com o docker.<br>
```
docker update --restart=always 98
```

Para verificar:<br>
```
docker inspect -f "{{ .HostConfig.RestartPolicy }}" <container_id>
docker inspect -f "{{ .RestartCount }}" <container_id>
docker inspect -f "{{ .State.StartedAt }}" <container_id>
```

Lista de todos os containers com id, status de restart e quantidadede (de restart)<br>
```
docker inspect -f "{{.Id}} {{.HostConfig.RestartPolicy.Name}} {{.RestartCount}}" $(docker container ls -q)
```

Explicando:<br>
Este comando lista todos os ids dos containers que estão rodando. Para incluir todos adicione -a.<br>
```
$(docker container ls -a -q)
```
# Formatando a saída
https://docs.docker.com/config/formatting/<br>
Use aspas simples externamente, internamente use aspas duplas como no exemplo a seguir:<br>
Este exemplo separa o id quando encontra a letra "e".<br>
Entrada c81e8baea8<br>
Saída c81 8ba a8<br>
```
docker inspect -f '{{split .Id "e"}} {{.HostConfig.RestartPolicy.Name}} {{.RestartCount}}' $(docker container ls -q)
```
Tamanho do campo<br>
```
docker inspect -f '{{len .Id}} {{.HostConfig.RestartPolicy.Name}} {{.RestartCount}}' $(docker container ls -q)
```
